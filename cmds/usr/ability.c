// annie 07.2003 && Silencer @ FY4 workgroup. Oct.2004


#include <ansi.h>
inherit F_ABILITY;

int main(object me, string arg)
{
	string *lists,temp,id;
	
	int i, a_num, saved_quest, saved_quest1, saved_ability, learned_ability;
	object ob;
	string arg1, myclass;
	
	if (wizardp(me))
	{
		if(arg && sscanf(arg, "-%s", id) == 1)
		{
			ob = present(id, environment(me));
			if (!ob) ob = find_player(id);
			if (!ob) ob = find_living(id);
			if (!ob) return notify_fail("ä½ è¦å¯Ÿçœ‹è°çš„èƒ½åŠ›ï¼Ÿ\n");			
		} else
			ob = me;					
	} else
		ob = me;

	saved_quest = ob->query("saved_quest")/60;
	saved_quest1 = (ob->query("saved_quest")*100/60)%100;
	saved_ability = saved_quest/100;			// 100ä¸ªQuestç®—ä¸€ä¸ªability
	learned_ability = ob->query("learned_ability");
	
	if (arg && ob==me)
	{
		if (!sscanf(arg,"+ %d",a_num))
			return notify_fail("æé«˜èƒ½åŠ›çš„æ ¼å¼ï¼šability + èƒ½åŠ›åç§° \n");
		if (a_num <1 || a_num > 20)
			return notify_fail("æ²¡æœ‰æ­¤ä»£ç çš„èƒ½åŠ›ï¼ˆè¯·è¾“å…¥1-20ï¼‰\n");
		if (F_LEVEL->get_level(ob->query("combat_exp"))< 80)
			return notify_fail("æé«˜èƒ½åŠ›è‡³å°‘éœ€è¦ç»éªŒç­‰çº§80ã€‚\n");
			
		if (a_num<16)
		{
			arg1 = g_ability[a_num-1];
			
			if (!check_ability_improve(ob, arg1,0))
				return notify_fail("ä½ çš„ç»éªŒç­‰çº§è¿˜ä¸è¶³ä»¥æŒæ¡æ›´é«˜çš„è¯¥é¡¹èƒ½åŠ›ã€‚\n");
			if (!deduct_ability_cost(ob, arg1,0))
				return notify_fail("ä½ æ²¡æœ‰è¶³å¤Ÿçš„èƒ½åŠ›ç‚¹å‚¨è“„æ¥æé«˜æ­¤é¡¹èƒ½åŠ›ã€‚\n");
			improve_ability( ob, arg1, 0);
			tell_object(ob, "è¯¥ç¬¬"+ (a_num) + "èƒ½åŠ›æé«˜å®Œæ¯•ã€‚\n");
			return 1;
		}
		
		if (!stringp(myclass = ob->query("class")))
			return notify_fail("ä½ æ— é—¨æ— æ´¾ï¼Œå¦‚ä½•èƒ½å¤Ÿé¢†ä¼šé—¨æ´¾æ­¦åŠŸçš„ç²¾é«“ï¼Ÿ\n");
		
		if (!arrayp(m_ability[myclass]))
		{
			return notify_fail("OOPSï¼Œä½ æ‰€åœ¨çš„é—¨æ´¾çš„ç‰¹è‰²è¿˜æ²¡å†™å¥½è€¶ã€‚\n");
		} else
		{	
			arg1 = m_ability[myclass][a_num-16];
			if (!check_ability_improve(ob, arg1,1))
				return notify_fail("ä½ çš„ç»éªŒç­‰çº§è¿˜ä¸è¶³ä»¥æŒæ¡æ›´é«˜çš„è¯¥é¡¹èƒ½åŠ›ã€‚\n");
			if (!deduct_ability_cost(ob, arg1,1))
				return notify_fail("ä½ æ²¡æœ‰è¶³å¤Ÿçš„èƒ½åŠ›ç‚¹å‚¨è“„æ¥æé«˜æ­¤é¡¹èƒ½åŠ›ã€‚\n");
			improve_ability( ob, arg1, 1);
			tell_object(ob, "è¯¥ç¬¬"+ (a_num) + "èƒ½åŠ›æé«˜å®Œæ¯•ã€‚\n");
		}
				
		return 1;
	}
	
	write(WHT"\tã€€ã€€		åŸºæœ¬èƒ½åŠ›è¿›é˜¶\n"NOR);
	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);
	write(WHT    "åºå·		åŠŸæ•ˆ			  ç­‰çº§	    	å‡çº§ç‚¹æ•°\n"NOR);	
	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);
	
	for(i=0; i<sizeof(g_ability); i++)
		write(WHT + (i+1)+ NOR"\t"+ get_ability_info(ob, g_ability[i],0) + NOR);		
	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);

		
	write(WHT"\tã€€ã€€		é—¨æ´¾èƒ½åŠ›è¿›é˜¶\n"NOR);
	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);
	
	if (!stringp(myclass = ob->query("class")))	write("æ— é—¨æ— æ´¾æ— ç‰¹è‰²ã€‚\n");
//	else if (ob->query("betrayer"))
//		write("ä½ æœ‰å›å¸ˆå‰ç§‘ï¼Œæ— æ³•é¢†ä¼šæ–°é—¨æ´¾çš„ç²¾é«“ã€‚\n");
	else if (!arrayp(m_ability[myclass]))
		write("OOPSï¼Œä½ æ‰€åœ¨çš„é—¨æ´¾çš„ç‰¹è‰²è¿˜æ²¡å†™å¥½è€¶ã€‚\n");
	else
		for(i=0; i<5; i++)
			write(WHT + (i+16)+ NOR"\t"+ get_ability_info(ob, m_ability[myclass][i],1) + NOR);		

	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);

	write("ä½ ç°åœ¨æ€»å…±å®Œæˆäº†"YEL+ saved_quest + "."+ saved_quest1+ NOR"ä¸ªèƒ½åŠ›Questï¼Œåˆè®¡"WHT + saved_ability + NOR"ç‚¹èƒ½åŠ›ã€‚
ä½ å·²ç»ç”¨å»äº†" RED+ learned_ability +NOR "ç‚¹èƒ½åŠ›ï¼Œè¿˜å‰©ä¸‹"HIG+ (saved_ability-learned_ability) + NOR"ç‚¹å¯ä¾›åˆ†é…ã€‚\n");

	write(HIR BLK"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n"NOR);
	
	return 1;
}


int help(object me)
{
write(@HELP

[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m
[0;1;36mæŒ‡ä»¤æ ¼å¼ : 	ability [0m
[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m   

ability 	è®©ä½ çŸ¥é“ä½ ç›®å‰æ‰€å­¦è¿‡çš„ä¸€åˆ‡èƒ½åŠ›ï¼Œ
ability + n	æé«˜ç¬¬ï½é¡¹èƒ½åŠ›çš„çº§åˆ«ã€‚

èƒ½åŠ›æ˜¯é£äº‘2005ä¸­é™¤ç»éªŒå€¼ã€æŠ€èƒ½å€¼ä»¥å¤–æé«˜è‡ªèº«çš„ä¸€ä¸ªé‡è¦é€”å¾„ã€‚
ç›¸åŒç»éªŒç­‰çº§çš„ï¼Œèƒ½åŠ›é«˜çš„äººä¼šæœ‰æ›´å¤šçš„æ°”è¡€ï¼Œé€ æˆæ›´å¤§çš„ä¼¤å®³åŠ›ï¼Œ
æˆ–è€…å¯ä»¥æœ‰æ›´é«˜çš„å­¦ä¹ æ•ˆç‡ã€‚å¦‚ä½•åˆç†åˆ†é…èƒ½åŠ›ç‚¹æ˜¯æˆä¸ºé«˜æ‰‹çš„ä¸€
å¤§åŸºæœ¬è¦æ±‚ã€‚

å½“ä½ çš„ç»éªŒçº§åˆ«åˆ°è¾¾80æ—¶ï¼Œå°±å¯ä»¥æé«˜è‡ªèº«çš„å„é¡¹èƒ½åŠ›äº†ï¼
è¾“å…¥ï½ï½‚ï½‰ï½Œï½‰ï½”ï½™å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ¸…æ™°çš„åˆ—è¡¨ã€‚åˆ†ä¸¤å¤§ç±»ï¼Œç¬¬ä¸€
ç±»å…±æœ‰ï¼‘ï¼•é¡¹ï¼Œæ‰€æœ‰é—¨æ´¾éƒ½å¯ä»¥ä¿®ä¹ ï¼Œå¤§å¤šæ˜¯æé«˜åŸºæœ¬å±æ€§çš„ï¼›ç¬¬
äºŒç±»æœ‰äº”é¡¹ï¼Œå±äºé—¨æ´¾æ­¦åŠŸçš„ç²¾é«“æ‰€åœ¨ï¼Œä¸åŒé—¨æ´¾å„æœ‰ç‰¹è‰²ã€‚

æ¯é¡¹èƒ½åŠ›å…±åˆ†åçº§ï¼Œæ¯çº§çš„åŠŸæ•ˆéƒ½æœ‰è¯¦ç»†è¯´æ˜ã€‚ä¿®ä¹ ç¬¬ä¸€ç±»èƒ½åŠ›çš„
è¦æ±‚ä¸ºç­‰çº§80ï¼Œä¿®ä¹ ç¬¬äºŒç±»èƒ½åŠ›çš„è¦æ±‚ä¸ºç­‰çº§100ã€‚ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œ
ä½ ä¹Ÿè®¸æœ€å¤šåªèƒ½ä¿®ä¹ åˆ°ç¬¬äºŒçº§ï¼Œéšç€ä½ æœ¬èº«ç­‰çº§çš„æé«˜ï¼Œç»éªŒæ¯å¢
é•¿äº”çº§ä¾¿å¯ä»¥å¤šä¿®ä¹ ä¸€ä¸ªèƒ½åŠ›çº§åˆ«ã€‚

è¯¥ä¿®ä¹ ä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±æ˜¯ç”±å„ä¸ªä¸åŒé—¨æ´¾çš„ç‰¹ç‚¹æˆ–è€…ä¸ªäººå–œå¥½æ‰€å†³å®š
äº†ã€‚å¦‚æœä½ æƒ³åœ¨æˆ˜æ–—ä¸­æŒä¹…ï¼Œå°±å¤šæé«˜äº›å¢é•¿ç²¾æ°”ç¥çš„èƒ½åŠ›ï¼Œå¦‚æœ
ä½ è¦æé«˜æ€ä¼¤åŠ›ï¼Œå°±æé«˜äº›åŠ›é‡ï¼Œå¦‚æœä½ æ˜¯åˆ©ç”¨æ³•æœ¯çš„é—¨æ´¾ï¼Œé‚£ä¹ˆ
æé«˜æ‰æ™ºå¯ä»¥å¢åŠ å‘½ä¸­ç‡ï¼Œæˆ–è€…å¤šåŠ äº›æ³•åŠ›ã€‚ã€‚ã€‚ã€‚

ä¿®ä¹ èƒ½åŠ›çš„ç‚¹æ•°ä»å“ªé‡Œæ¥ï¼Ÿå¾ˆç®€å•ï¼Œä¹Ÿæ˜¯ä»å®Œæˆå¤©æœºè€äººçš„Questä¸­
å¾—åˆ°ã€‚å½“ä½ çš„ç»éªŒç­‰çº§è¾¾åˆ°80æ—¶ï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªå‚æ•°
		set ability 1
åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒQuestå°†ä¸å†å¢åŠ ä½ çš„ç»éªŒå€¼ï¼Œè€Œæ˜¯è½¬å…¥èƒ½åŠ›ç‚¹ä¸­å‚¨å­˜
èµ·æ¥ï¼Œæ¯100ä¸ªQuestå¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªèƒ½åŠ›ç‚¹ä¾›ä½ åˆ†é…ã€‚å½“ä½ æƒ³ç»§ç»­
æé«˜ç»éªŒæ—¶ï¼Œåªéœ€è¦ set ability 0 å°±å¯ä»¥äº†ã€‚

æ³¨æ„ï¼Œä¸ä½œåˆ†é…çš„ABILITYç‚¹æ•°æœ€å¤šåªèƒ½å‚¨å­˜6ç‚¹ï¼Œè¶…è¿‡6ç‚¹åQuest
å¥–åŠ±å°†è‡ªåŠ¨åˆ†é…åˆ°ç»éªŒä¸Šã€‚

[0;1;37mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m  
HELP
    );

    return 1;
}
 
